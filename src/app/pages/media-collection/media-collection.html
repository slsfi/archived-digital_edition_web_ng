<ion-header *ngIf="mediaCollectionID || namedEntityID" class="ion-no-border">
  <ion-toolbar class="secondary">
    <a *ngIf="mediaCollectionID || namedEntityID" class="back-link" slot="start" [routerLink]="['/media-collection']">
      <ion-icon slot="start" name="arrow-back"></ion-icon>
      <span i18n="@@TOC.All">Alla</span>
    </a>

    <ion-buttons slot="end" class="secondary-toolbar-buttons-wrapper">
      <ion-button *ngIf="showURNButton && mediaCollectionID" (click)="showReference()">
        <ion-icon slot="start" name="arrow-redo-sharp"></ion-icon>
        <span class="side-title" i18n="@@Reference.refer">Hänvisa</span>
      </ion-button>
    </ion-buttons>

  </ion-toolbar>
</ion-header>

<ion-content>

  <div class="loading-overlay" [style.display]="zoomLoading ? null : 'none'">
    <ion-spinner class="loading" name="crescent"></ion-spinner>
  </div>

  <div class="page-title-wrapper">
    <h1 [innerHTML]="mediaTitle"></h1>
    <p *ngIf="(mediaCollectionID || namedEntityID) && galleryData.length">{{galleryData.length}} <ng-container i18n="@@MediaCollections.photos">foton</ng-container></p>
  </div>
  
  <p *ngIf="mediaDescription" [innerHTML]="mediaDescription"></p>

  <ng-container *ngIf="(mdContent$ | async) as mdContent">
    <div class="info markdown" [innerHTML]="mdContent"></div>
  </ng-container>

  <div *ngIf="galleryData.length && (filterOptionsKeywords.length > 1 || filterOptionsPersons.length > 1 || filterOptionsPlaces.length > 1)" class="gallery-filters">
    <ion-select *ngIf="filterOptionsPersons.length > 1"
          class="filter-persons"
          label="Filtrera enligt person"
          i18n-label="@@MediaCollections.filterPerson"
          label-placement="floating"
          fill="outline"
          okText="Ok"
          i18n-okText="@@BasicActions.Ok"
          cancelText="Avbryt"
          i18n-cancelText="@@BasicActions.Cancel"
          [interfaceOptions]="filterSelectOptions.person"
          [compareWith]="compareFilterOptionsWith"
          (ionChange)="onFilterChanged('person', $event)"
          [value]="selectedPersonFilter"
    >
      <ion-select-option [value]="null"></ion-select-option>
      <ion-select-option *ngFor="let filterOption of filterOptionsPersons; trackBy: trackById"
            [value]="filterOption" [innerHTML]="filterOption.name"
      ></ion-select-option>
    </ion-select>

    <ion-select *ngIf="filterOptionsPlaces.length > 1"
          class="filter-places"
          label="Filtrera enligt plats"
          i18n-label="@@MediaCollections.filterPlace"
          label-placement="floating"
          fill="outline"
          okText="Ok"
          i18n-okText="@@BasicActions.Ok"
          cancelText="Avbryt"
          i18n-cancelText="@@BasicActions.Cancel"
          [interfaceOptions]="filterSelectOptions.place"
          [compareWith]="compareFilterOptionsWith"
          (ionChange)="onFilterChanged('place', $event)"
          [value]="selectedPlaceFilter"
    >
      <ion-select-option [value]="null"></ion-select-option>
      <ion-select-option *ngFor="let filterOption of filterOptionsPlaces; trackBy: trackById"
            [value]="filterOption" [innerHTML]="filterOption.name"
      ></ion-select-option>
    </ion-select>

    <ion-select *ngIf="filterOptionsKeywords.length > 1"
          class="filter-keywords"
          label="Filtrera enligt ämnesord"
          i18n-label="@@MediaCollections.filterKeyword"
          label-placement="floating"
          fill="outline"
          okText="Ok"
          i18n-okText="@@BasicActions.Ok"
          cancelText="Avbryt"
          i18n-cancelText="@@BasicActions.Cancel"
          [interfaceOptions]="filterSelectOptions.keyword"
          [compareWith]="compareFilterOptionsWith"
          (ionChange)="onFilterChanged('keyword', $event)"
          [value]="selectedKeywordFilter"
    >
      <ion-select-option [value]="null"></ion-select-option>
      <ion-select-option *ngFor="let filterOption of filterOptionsKeywords; trackBy: trackById"
            [value]="filterOption" [innerHTML]="filterOption.name"
      ></ion-select-option>
    </ion-select>
  </div>

  <p *ngIf="filterResultCount > -1" class="filter-results"><ng-container>Filterresultat</ng-container>: {{filterResultCount}}</p>

  <ion-grid>
    <ion-row>
      <ng-container *ngFor="let item of galleryData; index as i; trackBy: trackById">
        <ion-col *ngIf="item.visible" size="12" size-sm="6" size-md="4" size-xl="3">
          <div class="item-wrapper">
            <ng-container *ngIf="mediaCollectionID || namedEntityID; else allGalleries">
              <button (click)="openImage(i)">
                <ng-container *ngTemplateOutlet="innerGridItem; context: {$implicit: item}"/>
              </button>
            </ng-container>
            <ng-template #allGalleries>
              <a [routerLink]="item.subItemCount ? ['/media-collection', item.collectionID] : ''" [title]="item.title">
                <ng-container *ngTemplateOutlet="innerGridItem; context: {$implicit: item}"/>
              </a>
            </ng-template>
          </div>
        </ion-col>
      </ng-container>
    </ion-row>
  </ion-grid>

</ion-content>

<ng-template #innerGridItem let-item>
  <img *ngIf="item.imageURLThumb"
        [src]="item.imageURLThumb"
        [alt]="item.imageAltText"
        loading="lazy"
  >
  <div *ngIf="(item.title || item.subTitle) && !namedEntityID || item.description" class="item-meta-wrapper">
    <div *ngIf="(item.title || item.subTitle) && !namedEntityID" class="item-title">
      <h2>
        <span *ngIf="item.title" [innerHTML]="item.title"></span>
        <br *ngIf="item.title && item.subTitle">
        <span *ngIf="item.subTitle" class="subtitle" [innerHTML]="item.subTitle"></span>
      </h2>
      <p *ngIf="item.subItemCount">{{item.subItemCount}} <ng-container i18n="@@MediaCollections.photos">foton</ng-container></p>
    </div>
    <p *ngIf="item.description" class="description" [innerHTML]="item.description"></p>
  </div>
</ng-template>
