<ng-container *ngIf="!isLoading">
  <div class="menu-header">
    <a class="go-back-menu-item" [routerLink]="['/']"><ion-icon name="arrow-back-sharp"></ion-icon> <span i18n="@@BackButton">Tillbaka</span></a>
    <h1>{{collectionTitle}}</h1>
  </div>
  <ul role="menu">
    <li *ngIf="_config.HasCover" [attr.aria-current]="initialUrlSegments[2].path === 'cover' ? 'page' : null" role="menuitem">
      <a routerLink="{{collectionID | collectionPathGenerator: 'cover'}}" [class.menu-highlight]="initialUrlSegments[2].path === 'cover'">
        <span class="label" i18n="@@Read.CoverPage.Title">Omslag</span>
      </a>
    </li>
    <li *ngIf="_config.HasTitle" [attr.aria-current]="initialUrlSegments[2].path === 'title' ? 'page' : null" role="menuitem">
      <a routerLink="{{collectionID | collectionPathGenerator: 'title'}}" [class.menu-highlight]="initialUrlSegments[2].path === 'title'">
        <span class="label" i18n="@@Read.TitlePage.Title">Titelblad</span>
      </a>
    </li>
    <li *ngIf="_config.HasForeword" [attr.aria-current]="initialUrlSegments[2].path === 'foreword' ? 'page' : null" role="menuitem">
      <a routerLink="{{collectionID | collectionPathGenerator: 'foreword'}}" [class.menu-highlight]="initialUrlSegments[2].path === 'foreword'">
        <span class="label" i18n="@@Read.ForewordPage.Title">FÃ¶rord</span>
      </a>
    </li>
    <li *ngIf="_config.HasIntro" [attr.aria-current]="initialUrlSegments[2].path === 'introduction' ? 'page' : null" role="menuitem">
      <a routerLink="{{collectionID | collectionPathGenerator: 'introduction'}}" [class.menu-highlight]="initialUrlSegments[2].path === 'introduction'">
        <span class="label" i18n="@@Read.Introduction.Title">Inledning</span>
      </a>
    </li>
    <ng-container *ngTemplateOutlet="recursiveMenu; context: {$implicit: collectionContent.children}"/>
  </ul>
</ng-container>

<ng-template #recursiveMenu let-list>
  <ng-container *ngFor="let item of list">
    <li 
          [attr.data-id]="item.itemId ? 'toc_' + item.itemId : ''"
          [attr.aria-current]="highlightedMenu === item.itemId ? 'page' : null"
          [attr.aria-haspopup]="item.children ? 'menu' : null"
          [attr.aria-expanded]="item.children ? selectedMenu.includes(item.itemId) || selectedMenu.includes(item.nodeId) : null"
          role="menuitem"
    >
      <a *ngIf="item.itemId"
            [routerLink]="item.itemId | pagePathGenerator"
            [queryParams]="item.itemId | positionParamGenerator"
            [class.menu-highlight]="highlightedMenu === item.itemId"
            [class.submenu-label]="item.children"
      >
        <ng-container *ngTemplateOutlet="menuItemContent; context: {$implicit: item}"/>
      </a>
      <button *ngIf="!item.itemId"
            (click)="toggle(item)"
            [class.submenu-label]="item.children"
      >
        <ng-container *ngTemplateOutlet="menuItemContent; context: {$implicit: item}"/>
      </button>
      <ul *ngIf="item.children" role="menu"
            [class.open]="selectedMenu.includes(item.itemId) || selectedMenu.includes(item.nodeId)"
      >
        <ng-container *ngTemplateOutlet="recursiveMenu; context: {$implicit: item.children}"/>
      </ul>
    </li>
  </ng-container>
</ng-template>

<ng-template #menuItemContent let-item>
    <span class="label">
      {{item.text}}
      <span class="description" *ngIf="item.description">{{item.description}}</span>
    </span>
    <ion-icon *ngIf="item.children" name="chevron-forward-outline" class="toggle-icon"
          [class.open]="selectedMenu.includes(item.itemId) || selectedMenu.includes(item.nodeId)"
    ></ion-icon>
</ng-template>
