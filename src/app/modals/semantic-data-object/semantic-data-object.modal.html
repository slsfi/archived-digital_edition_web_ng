<ion-header>
    <ion-toolbar>
      <ion-title>
        <ng-container *ngIf="type === 'subject'" i18n="@@Occurrences.person">Person</ng-container>
        <ng-container *ngIf="type === 'location'" i18n="@@Occurrences.place">Plats</ng-container>
        <ng-container *ngIf="type === 'tag'" i18n="@@Occurrences.keyword">Ämnesord</ng-container>
        <ng-container *ngIf="type === 'work'" i18n="@@Occurrences.work">Verk</ng-container>
      </ion-title>
      <ion-buttons slot="end">
        <ion-button class="close" fill="clear" (click)="cancel()">
          <ion-icon name="close" slot="icon-only" aria-label="Stäng" i18n-aria-label="@@BasicActions.Close"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>
  
  <ion-content class="ion-padding">
    <div class="sd-wrapper">
      <ng-container *ngIf="(objectData$ | async) as data; else loadingOrError">
  
        <div class="sd-header" *ngIf="data">
          <h2>
            <span *ngIf="data?.details?.occupation && !hideTypeAndDescription" class="occupation">{{data.details.occupation}} – </span><span class="title" [innerHTML]="data?.details?.title"></span><span *ngIf="data?.details?.year_born_deceased" class="date"> {{data.details.year_born_deceased}}</span><span *ngIf="data?.details?.latitude && data?.details?.longitude" class="coordinates"> (<a [href]="'https://www.openstreetmap.org/?mlat=' + data.details.latitude + '&mlon=' + data.details.longitude" target="_blank"><ng-container i18n="@@Occurrences.latitude">lat.</ng-container> {{data.details.latitude}}, <ng-container i18n="@@Occurrences.longitude">long.</ng-container> {{data.details.longitude}}</a>)</span>
          </h2>
          <div class="media_image_wrapper" *ngIf="data?.media?.imageUrl">
            <img alt="occurrence image" [src]="data.media.imageUrl">
          </div>
          <div class="media_description" *ngIf="data?.media?.description">
            {{data.media.description}}
          </div>
        </div>
  
        <div class="sd-box"
            *ngIf="(data?.details?.city && !hideCityRegionCountry) || (data?.details?.region && !hideCityRegionCountry) || (data?.details?.country && !hideCityRegionCountry) || data?.details?.place_of_birth || (data?.details?.type && !hideTypeAndDescription) || data?.details?.source || data?.details?.publisher || data?.details?.published_year || data?.details?.isbn || (data?.details?.author_data?.length && data?.details?.author_data[0]) || data?.details?.journal || data?.details?.description || data?.articles?.length || data?.galleryOccurrences?.length"
        >
          <dl
                *ngIf="(data?.details?.city && !hideCityRegionCountry) || (data?.details?.region && !hideCityRegionCountry) || (data?.details?.country && !hideCityRegionCountry) || data?.details?.place_of_birth || (data?.details?.type && !hideTypeAndDescription) || data?.details?.source || data?.details?.publisher || data?.details?.published_year || data?.details?.isbn || (data?.details?.author_data?.length && data?.details?.author_data[0]) || data?.details?.journal || (data?.details?.description && !hideTypeAndDescription) || data?.articles?.length"
          >
            <div *ngIf="data?.details?.city && !hideCityRegionCountry" class="city">
              <dt i18n="@@Occurrences.city">Stad</dt>
              <dd>{{data.details.city}}</dd>
            </div>
            <div *ngIf="data?.details?.region && !hideCityRegionCountry" class="region">
              <dt i18n="@@Occurrences.region">Region</dt>
              <dd>{{data.details.region}}</dd>
            </div>
            <div *ngIf="data?.details?.country && !hideCityRegionCountry" class="country">
              <dt i18n="@@Occurrences.country">Land</dt>
              <dd>{{data.details.country}}</dd>
            </div>
            <div *ngIf="data?.details?.place_of_birth" class="place_of_birth">
              <dt i18n="@@Occurrences.place_of_birth">Ort</dt>
              <dd>{{data.details.place_of_birth}}</dd>
            </div>
            <div *ngIf="data?.details?.type && !hideTypeAndDescription" class="type">
              <dt i18n="@@Occurrences.type">Typ</dt>
              <dd>{{data.details.type}}</dd>
            </div>
            <div *ngIf="data?.details?.source" class="source">
              <dt i18n="@@Occurrences.source">Källa</dt>
              <dd><a [href]="data.details.source" target="_blank">{{data.details.source}}</a></dd>
            </div>
            <div *ngIf="data?.details?.author_data?.length && data?.details?.author_data[0]" class="authors">
              <dt i18n="@@Occurrences.authors">Författare</dt>
              <dd>
                  <ng-container *ngFor="let author of data.details.author_data; last as lastAuthor">
                    {{author.full_name}}<ng-container *ngIf="!lastAuthor"><br></ng-container>
                  </ng-container>
              </dd>
            </div>
            <div *ngIf="data?.details?.publisher" class="publisher">
              <dt i18n="@@Occurrences.publisher">Utgivare</dt>
              <dd>{{data.details.publisher}}</dd>
            </div>
            <div *ngIf="data?.details?.published_year" class="published_year">
              <dt i18n="@@Occurrences.published_year">Utgivningsår</dt>
              <dd>{{data.details.published_year}}</dd>
            </div>
            <div *ngIf="data?.details?.isbn" class="isbn">
              <dt i18n="@@Occurrences.isbn">ISBN</dt>
              <dd>{{data.details.isbn}}</dd>
            </div>
            <div *ngIf="data?.details?.journal" class="journal">
              <dt i18n="@@Occurrences.journal">Journal</dt>
              <dd>{{data.details.journal}}</dd>
            </div>
            <div *ngIf="data?.articleData?.length" class="articles">
              <dt i18n="@@Occurrences.articles">Artiklar</dt>
              <dd>
                <ng-container *ngFor="let article of data.articleData; let i = index; last as lastArticle">
                  <span class="article_count">{{i+1}}.</span> <span class="article_description">{{article.description}}</span><span class="article_link"> – <a [href]="article.pdf_path" target="_blank" i18n="@@Occurrences.download">ladda ner pdf</a></span><ng-container *ngIf="!lastArticle"><br></ng-container>
                </ng-container>
            </dd>
            </div>
            <div *ngIf="data?.details?.description && !hideTypeAndDescription" class="description">
              <dt i18n="@@Occurrences.description">Beskrivning</dt>
              <dd>{{data.details.description}}</dd>
            </div>
          </dl>
          <p *ngIf="data?.details?.description && hideTypeAndDescription" class="description">{{data.details.description}}</p>
          <ion-button *ngIf="data?.galleryOccurrences?.length" class="custom-outline-button" fill="outline" i18n="@@TOC.MediaCollections" (click)="openGallery(data.galleryOccurrences[0])">Bildbank</ion-button>
        </div>
  
        <ng-container *ngIf="showOccurrences && data?.details?.id">
          <h3 i18n="@@Occurrences.Title">Förekomster</h3>
          <occurrences-accordion [id]="data?.details?.id" [type]="type"></occurrences-accordion>
        </ng-container>
  
      </ng-container>
  
      <ng-template #loadingOrError>
        <div *ngIf="(loadingErrorData$ | async); else loading" class="sd-box">
          <p i18n="@@Occurrences.NoInfoFound">Ingen information hittades.</p>
        </div>
  
        <ng-template #loading>
          <ion-spinner class="loading" name="crescent"></ion-spinner>
        </ng-template>
      </ng-template>
  
    </div>
  </ion-content>
  